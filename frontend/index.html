<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GetItDone</title>
    <link rel="icon" href="icons/favicon-32x32.png" type="image/png">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles/main.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/idb@7/build/umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@1/index.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
</head>
<body>
        <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>
    <!-- Authentication section (shown when not logged in) -->
    <div id="authSection">
        <div class="auth-card">
            <h2>Welcome to GetItDone</h2>
            <p>Organize your day, boost productivity, and conquer your goals!</p>
            <form id="authForm" method="post" action="/login">
                <label for="email">Email</label>
                <input
                    type="email"
                    id="email"
                    name="email"
                    placeholder="Enter your email"
                    autocomplete="email"
                    aria-label="Email address"
                    required
                >
                
                <label for="password">Password</label>
                <div class="password-input-container">
                    <input
                        type="password"
                        id="password"
                        name="password"
                        placeholder="Enter your password"
                        autocomplete="current-password"
                        aria-label="Password"
                        required
                    >
                    <button type="button" id="togglePassword" class="password-toggle" 
                            aria-label="Show password" onclick="togglePasswordVisibility()">
                        <span class="material-icons">visibility_off</span>
                    </button>
                </div>
                
                <button type="submit" id="authBtn">Sign In</button>
                <p id="authToggle">
                    Don't have an account? <a href="#" id="toggleAuth">Sign Up</a>
                </p>
                <p><a href="#" id="forgotPassword">Forgot Password?</a></p>
                <p id="authError" style="display: none;"></p>
            </form>

            <button id="guestBtn">Continue as Guest (some features unavailable)</button>
        </div>
    </div>
    <div class="install-prompt" id="installPrompt">
        <button class="close-btn" id="closeInstallPrompt" aria-label="Close install prompt">‚úï</button>
        <h3>Install App</h3>
        <p style="color: #E5E5E5; font-size: clamp(14px, 3vw, 16px); text-align: center;">
            Install the app for a better experience, including offline access and notifications!
        </p>
        <div class="install-buttons">
            <button id="installBtn">‚úÖ Install</button>
            <button class="cancel-btn" id="dismissInstallBtn">‚ùå Not Now</button>
        </div>
    </div>

    <div class="container">
        <div class="button-container">
            <button class="add-task-btn" id="showFormBtn">‚ûï Add My Own Custom Task</button>
            <div class="desktop-buttons">
                <button class="report-btn" id="showReportBtn">üìä View Report</button>
                <button class="settings-btn" id="showSettingsBtn">‚öôÔ∏è Settings</button>
                <button class="reset-default-btn" id="resetDefaultBtn">‚ùì Help/FAQ</button>
            </div>
            <!-- Mobile dropdown (hidden on desktop) -->
            <div class="mobile-dropdown">
                <button class="more-options-btn">More Options ‚ñº</button>
                <div class="dropdown-content">
                    <button class="report-btn" id="mobileShowReportBtn">üìä View Report</button>
                    <button class="settings-btn" id="mobileShowSettingsBtn">‚öôÔ∏è Settings</button>
                    <button class="reset-default-btn" id="mobileResetDefaultBtn">‚ùì Help/FAQ</button>
                </div>
            </div>
        </div>

        <div id="customTaskBanner" class="banner hidden">
            <p>Feel free to edit or delete Any tasks. Just add your own ‚Äî I‚Äôll keep everything neatly sorted for you.</p>
            <button id="dismissBannerBtn" aria-label="Dismiss banner">Got it</button>
        </div>

        <!-- Task Form (Add Task) -->
        <div class="task-form" id="taskForm">
            <h3>Create New Task</h3>
            <input type="hidden" id="editTaskIndex">
            <label for="startTime">Start Time</label>
            <input type="time" id="startTime" aria-label="Task start time">
            <label for="endTime">End Time</label>
            <input type="time" id="endTime" aria-label="Task end time">
            <label for="taskName">Task Name</label>
            <div class="emoji-input-wrapper">
                <input type="text" id="taskName" placeholder="e.g., Morning Walk" aria-label="Task name">
                <button type="button" class="emoji-btn">üòä</button>
            </div>
            <emoji-picker class="emoji-picker"></emoji-picker>
            <label for="category">Category</label>
            <select id="category" aria-label="Task category" required>
                <option value="" disabled selected>Select Category</option>
                <option value="Health">Health</option>
                <option value="Fitness">Fitness</option>
                <option value="Routine">Routine</option>
                <option value="Learning">Learning</option>
                <option value="Project">Project</option>
                <option value="Leisure">Leisure</option>
                <option value="Personal Growth">Personal Growth</option>
                <option value="General">General</option>
                <option value="Professional">Professional</option>
                <option value="Finance">Finance</option>
                <option value="Custom">Custom</option>
            </select>
            <input type="text" id="custom-category" placeholder="Enter custom category" aria-label="Custom task category" style="display: none;">
            <label for="priority">Priority</label>
            <select id="priority" aria-label="Task priority">
                <option value="">Select Priority</option>
                <option value="High">High</option>
                <option value="Medium">Medium</option>
                <option value="Low">Low</option>
            </select>
            <div class="form-buttons">
                <button id="addTaskBtn">‚úÖ Save Task</button>
                <button class="clear-btn" id="clearFormBtn">üßπ Clear Form</button>
                <button class="cancel-btn" id="cancelFormBtn">‚ùå Cancel</button>
            </div>
        </div>

        <!-- Edit Task Modal -->
        <div class="modal" id="edit-task-modal">
            <h3>Edit Task</h3>
            <input type="hidden" id="editTaskIndex">
            <label for="edit-startTime">Start Time</label>
            <input type="time" id="edit-startTime" aria-label="Task start time">
            <label for="edit-endTime">End Time</label>
            <input type="time" id="edit-endTime" aria-label="Task end time">
            <label for="edit-taskName">Task Name</label>
            <div class="emoji-input-wrapper">
                <input type="text" id="edit-taskName" placeholder="e.g., Morning Walk" aria-label="Task name">
                <button type="button" class="emoji-btn">üòä</button>
            </div>
            <emoji-picker class="emoji-picker"></emoji-picker>
            <label for="edit-category">Category</label>
            <select id="edit-category" aria-label="Task category" required>
                <option value="" disabled selected>Select Category</option>
                <option value="Health">Health</option>
                <option value="Fitness">Fitness</option>
                <option value="Routine">Routine</option>
                <option value="Learning">Learning</option>
                <option value="Project">Project</option>
                <option value="Leisure">Leisure</option>
                <option value="Personal Growth">Personal Growth</option>
                <option value="General">General</option>
                <option value="Professional">Professional</option>
                <option value="Finance">Finance</option>
                <option value="Custom">Custom</option>
            </select>
            <input type="text" id="edit-custom-category" placeholder="Enter custom category" aria-label="Custom task category" style="display: none;">
            <label for="edit-priority">Priority</label>
            <select id="edit-priority" aria-label="Task priority">
                <option value="">Select Priority</option>
                <option value="High">High</option>
                <option value="Medium">Medium</option>
                <option value="Low">Low</option>
            </select>
            <div class="modal-buttons">
                <button id="saveEditBtn">‚úÖ Save Task</button>
                <button class="modal-cancel-btn" id="cancelEditBtn">‚ùå Cancel</button>
            </div>
        </div>

        <div class="modal" id="lateTaskModal">
            <h3>Complete Task Late</h3>
            <p class="modal-error" id="modalError">Please enter a reason.</p>
            <label for="lateReason">Reason for Late Completion</label>
            <input type="text" id="lateReason" placeholder="e.g., Delayed by meeting" aria-label="Reason for late task">
            <div class="modal-buttons">
                <button id="modalConfirmBtn" disabled>‚úÖ Confirm</button>
                <button class="modal-cancel-btn" id="modalCancelBtn">‚ùå Cancel</button>
            </div>
        </div>

        <div class="modal" id="settingsModal">
            <h3>Settings</h3>
            <button id="myAccountBtn">My Account</button>
            <p class="permission-error" id="permissionError">Enable notifications personally in browser settings.</p>
            <label><input type="checkbox" id="enableReminders"> Enable Task Reminders</label>
            <p>Reminders fire 10 minutes before each task.</p>
            <label for="userName">Your Name (Optional)</label>
            <input type="text" id="userName" placeholder="Your Name" aria-label="Your name for notifications" autocomplete="name">
            
            <div id="myAccount" class="dropdown hidden">
                <p id="accountEmail">Logged in as: Not logged in</p>
                <p id="accountType">Account Type: Guest</p>
                <button id="logoutBtn">Log Out</button>
            </div>
            <div class="modal-buttons">
                <button id="saveSettingsBtn">‚úÖ Save</button>
                <button class="modal-cancel-btn" id="cancelSettingsBtn">‚ùå Cancel</button>
            </div>
        </div>

        <header>
            <h1>Fueling the Future: One Day at a Time</h1>
            <p class="tagline">"Success is the sum of small efforts, repeated day in and day out." ‚Äì Robert Collier</p>
        </header>

        <div class="schedule" id="scheduleContainer">
            <ul id="taskList"></ul>
        </div>

        <header>
            <p class="tagline">"The strength to conquer tomorrow lies in the relentless drive to master today." ‚Äì Jordan B. Peterson</p>
        </header>

        <div class="footer-wrapper">
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <p id="progressText">0% Completed</p>
            <div class="stats-panel" id="statsPanel">
                <h3>Weekly Report</h3>
                <div class="stats-section">
                    <h4>Summary</h4>
                    <p id="weeklySummary"></p>
                    <hr class="stats-divider">
                    <p id="weeklyDetails"></p>
                </div>
                <div class="stats-section">
                    <h4>Completion Trend</h4>
                    <p id="chartError">Chart failed to load. Please try refreshing.</p>
                    <canvas id="statsChart"></canvas>
                </div>
            </div>
            <div id="congratsMessage">Congratulations!</div>
            <canvas id="confettiCanvas"></canvas>

            <!-- Back to Top Button -->
            <button class="back-to-top" id="backToTopBtn" aria-label="Back to Top">
                <span class="back-to-top-icon">‚Üë</span>
                <span class="back-to-top-text">Back to Top</span>
            </button>

            <!-- Footer -->
            <footer class="help-footer">
                <div class="container">
                    <p class="footer-text">
                        <a href="privacy.html">Privacy Policy</a> | 
                        <a href="tos.html">Terms of Service</a>
                        Designed and built by Kennedy &copy; 2025 | 
                        <a href="https://www.linkedin.com/in/kennedy-munene-dsml" target="_blank">LinkedIn</a> | 
                        <a href="https://github.com/Kennedy178" target="_blank">GitHub</a> | 
                        <a href="#" id="contactDeveloper">Contact Developer</a>    
                    </p>
                </div>
            </footer>
        </div>

        <!-- Global Modal -->
        <div id="logoutConfirmModal">
            <div class="logout-modal-content">
                <!-- For Authenticated Users -->
                <div id="authUserLogout">
                    <h3>Confirm Logout</h3>
                    <p>You're about to log out. This will:</p>
                    <ul>
                        <li>Disable offline reminders</li>
                        <li>Stop cross-device syncing</li>
                    </ul>
                    <div class="modal-actions">
                        <button id="confirmLogoutBtn" class="danger-btn">Log Out Anyway</button>
                        <button id="cancelLogoutBtn" class="cancel-btn">Cancel</button>
                    </div>
                </div>
                
                <!-- For Guest Users -->
                <div id="guestLogoutPrompt" class="guest-logout-message hidden">
                    <h3>Create an Account</h3>
                    <p>You're currently in guest mode. Sign up to:</p>
                    <ul>
                        <li>Sync across devices</li>
                        <li>Enable reminders</li>
                        <li>Backup your tasks</li>
                    </ul>
                    <button id="goToSignupBtn" class="auth-btn">Sign Up Now</button>
                    <p>Already have an account? <a href="#" id="goToLoginLink">Sign In</a></p>
                </div>
            </div>
        </div>
    </div>
    <script src="scripts/config.js"></script> 
    <script type="module" src="scripts/auth.js"></script>
    <script type="module" src="scripts/app.js"></script>
    <script type="module" src="scripts/authHandler.js"></script>
</body>
</html>